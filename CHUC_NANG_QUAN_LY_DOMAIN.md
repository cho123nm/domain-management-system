# üåê **TR√åNH B√ÄY THI·∫æT K·∫æ V√Ä X√ÇY D·ª∞NG CH·ª®C NƒÇNG QU·∫¢N L√ù DOMAIN**

## üìù **1. M√î T·∫¢ CH·ª®C NƒÇNG:**

Ch·ª©c nƒÉng qu·∫£n l√Ω domain cho ph√©p ng∆∞·ªùi d√πng xem danh s√°ch c√°c domain ƒë√£ mua, c·∫≠p nh·∫≠t th√¥ng tin DNS, xem l·ªãch s·ª≠ giao d·ªãch v√† qu·∫£n l√Ω c√°c domain c·ªßa m√¨nh. Ng∆∞·ªùi d√πng c√≥ th·ªÉ thay ƒë·ªïi nameserver, xem tr·∫°ng th√°i domain v√† th·ª±c hi·ªán c√°c thao t√°c qu·∫£n l√Ω kh√°c.

## üë§ **2. T√ÅC NH√ÇN TH·ª∞C HI·ªÜN:**

- **Ng∆∞·ªùi d√πng ƒë√£ ƒëƒÉng nh·∫≠p** - User c√≥ t√†i kho·∫£n v√† ƒë√£ mua domain

## üîç **3. D·∫†NG TRUY V·∫§N:**

- **SELECT** - L·∫•y danh s√°ch domain c·ªßa user, th√¥ng tin DNS
- **UPDATE** - C·∫≠p nh·∫≠t th√¥ng tin DNS cho domain
- **INSERT** - Th√™m ghi ch√∫ ho·∫∑c l·ªãch s·ª≠ thay ƒë·ªïi

## üóÑÔ∏è **4. TRUY V·∫§N V√ÄO TABLE:**

- **Table:** `History` (l∆∞u th√¥ng tin domain ƒë√£ mua v√† DNS)
- **Table:** `Users` (th√¥ng tin ng∆∞·ªùi d√πng)
- **Table:** `ListDomain` (th√¥ng tin lo·∫°i domain)

## üìä **5. C·ªòT TH√îNG TIN TRONG TABLE C·∫¶N D√ôNG:**

### **Table History:**

- `id` (int) - ID giao d·ªãch
- `uid` (int) - ID ng∆∞·ªùi d√πng
- `domain` (varchar) - T√™n domain
- `ns1` (varchar) - Nameserver 1
- `ns2` (varchar) - Nameserver 2
- `status` (int) - Tr·∫°ng th√°i (0: ch·ªù, 1: ho√†n th√†nh)
- `time` (datetime) - Th·ªùi gian mua
- `note` (text) - Ghi ch√∫

### **Table Users:**

- `id` (int) - ID ng∆∞·ªùi d√πng
- `taikhoan` (varchar) - T√™n t√†i kho·∫£n
- `sodu` (int) - S·ªë d∆∞ hi·ªán t·∫°i

## üîÑ **6. LU·ªíNG S·ª∞ KI·ªÜN TR∆Ø·ªöC KHI TH·ª∞C HI·ªÜN:**

1. **User ƒëƒÉng nh·∫≠p v√†o h·ªá th·ªëng** (ƒë√£ c√≥ session)
2. **User truy c·∫≠p trang qu·∫£n l√Ω domain** ho·∫∑c URL `/Pages/managers.php`
3. **H·ªá th·ªëng ki·ªÉm tra quy·ªÅn truy c·∫≠p** (ƒë√£ ƒëƒÉng nh·∫≠p)
4. **H·ªá th·ªëng load danh s√°ch domain** c·ªßa user t·ª´ database

## üîÑ **7. LU·ªíNG S·ª∞ KI·ªÜN SAU KHI TH·ª∞C HI·ªÜN:**

1. **Th√†nh c√¥ng:** Hi·ªÉn th·ªã danh s√°ch domain v·ªõi th√¥ng tin DNS, cho ph√©p c·∫≠p nh·∫≠t
2. **C·∫≠p nh·∫≠t DNS:** L∆∞u th√¥ng tin nameserver m·ªõi v√†o database
3. **Xem chi ti·∫øt:** Hi·ªÉn th·ªã th√¥ng tin chi ti·∫øt domain
4. **Th√¥ng b√°o:** Hi·ªÉn th·ªã k·∫øt qu·∫£ c·∫≠p nh·∫≠t th√†nh c√¥ng/th·∫•t b·∫°i

## üìä **8. S∆† ƒê·ªí LU·ªíNG X·ª¨ L√ù:**

```
Client (User Browser)
    ‚Üì GET Request
    ‚Üì URL: /Pages/managers.php
    ‚Üì Session Authentication
Web Server (Apache)
    ‚Üì X√°c th·ª±c session
    ‚Üì X·ª≠ l√Ω request
File PHP x·ª≠ l√Ω
    ‚Üì Pages/managers.php
    ‚Üì include_once HistoryRepository.php
    ‚Üì $historyRepo = new HistoryRepository($connect)
PHP Processing
    ‚Üì HistoryRepository->listByUserId()
    ‚Üì SELECT * FROM History WHERE uid = ? AND status = 1
Database (MySQL)
    ‚Üì Table: History
    ‚Üì Tr·∫£ v·ªÅ: Array domain c·ªßa user
Response
    ‚Üì Render HTML table v·ªõi d·ªØ li·ªáu
    ‚Üì Hi·ªÉn th·ªã danh s√°ch qu·∫£n l√Ω domain
```

## üóÉÔ∏è **9. B·∫¢NG RECORDSET V√Ä ARRAY[KEY]:**

### **D·ªØ li·ªáu th·ª±c t·∫ø trong database:**

```sql
-- Truy v·∫•n ch√≠nh
SELECT h.*, u.taikhoan, u.sodu
FROM History h
LEFT JOIN Users u ON h.uid = u.id
WHERE h.uid = ? AND h.status = 1
ORDER BY h.time DESC;

-- K·∫øt qu·∫£ m·∫´u:
| id | uid | domain        | ns1              | ns2              | status | time       | taikhoan | sodu |
|----|-----|---------------|------------------|------------------|--------|------------|----------|------|
| 1  | 2   | example.com   | ns1.example.com  | ns2.example.com  | 1      | 2024-01-01 | user1    | 400000|
| 2  | 2   | test.net      | ns1.test.net     | ns2.test.net     | 1      | 2024-01-02 | user1    | 400000|
```

### **Array[key] s·ª≠ d·ª•ng trong PHP:**

```php
// K·∫øt qu·∫£ t·ª´ HistoryRepository->listByUserId()
$userDomains = [
    [
        'id' => 1,
        'uid' => 2,
        'domain' => 'example.com',
        'ns1' => 'ns1.example.com',
        'ns2' => 'ns2.example.com',
        'status' => 1,
        'time' => '2024-01-01 10:30:00',
        'taikhoan' => 'user1',
        'sodu' => 400000
    ],
    [
        'id' => 2,
        'uid' => 2,
        'domain' => 'test.net',
        'ns1' => 'ns1.test.net',
        'ns2' => 'ns2.test.net',
        'status' => 1,
        'time' => '2024-01-02 14:20:00',
        'taikhoan' => 'user1',
        'sodu' => 400000
    ]
];

// S·ª≠ d·ª•ng trong v√≤ng l·∫∑p
foreach ($userDomains as $domain) {
    echo $domain['domain'];     // T√™n domain
    echo $domain['ns1'];        // Nameserver 1
    echo $domain['ns2'];        // Nameserver 2
    echo $domain['time'];       // Th·ªùi gian mua
}
```

## üñºÔ∏è **10. GIAO DI·ªÜN CH·ª®C NƒÇNG:**

### **Trang qu·∫£n l√Ω domain:**

```html
<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Qu·∫£n L√Ω Domain - T√†i Kho·∫£n</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body>
    <div class="min-h-screen bg-gray-50">
      <!-- Header -->
      <div class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
          <div class="flex justify-between items-center py-6">
            <h1 class="text-3xl font-bold text-gray-900">Qu·∫£n L√Ω Domain</h1>
            <div class="text-sm text-gray-500">Qu·∫£n l√Ω domain c·ªßa b·∫°n</div>
          </div>
        </div>
      </div>

      <!-- Main Content -->
      <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Th√¥ng tin t√†i kho·∫£n -->
        <div class="bg-white shadow rounded-lg mb-6">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">
              Th√¥ng tin t√†i kho·∫£n
            </h3>
          </div>
          <div class="p-6">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
              <div class="text-center">
                <div
                  class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3"
                >
                  <svg
                    class="w-8 h-8 text-blue-600"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                </div>
                <h4 class="text-sm font-medium text-gray-900">T√†i kho·∫£n</h4>
                <p class="text-sm text-gray-500">user1</p>
              </div>
              <div class="text-center">
                <div
                  class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3"
                >
                  <svg
                    class="w-8 h-8 text-green-600"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"
                    ></path>
                  </svg>
                </div>
                <h4 class="text-sm font-medium text-gray-900">S·ªë d∆∞</h4>
                <p class="text-sm text-gray-500">400,000ƒë</p>
              </div>
              <div class="text-center">
                <div
                  class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3"
                >
                  <svg
                    class="w-8 h-8 text-purple-600"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                  >
                    <path
                      fill-rule="evenodd"
                      d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z"
                      clip-rule="evenodd"
                    ></path>
                  </svg>
                </div>
                <h4 class="text-sm font-medium text-gray-900">T·ªïng domain</h4>
                <p class="text-sm text-gray-500">2 domain</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Danh s√°ch domain -->
        <div class="bg-white shadow rounded-lg">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-medium text-gray-900">
              Danh s√°ch domain c·ªßa b·∫°n
            </h3>
          </div>
          <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
              <thead class="bg-gray-50">
                <tr>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Domain
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Nameserver
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Tr·∫°ng th√°i
                  </th>
                  <th
                    class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    Ng√†y mua
                  </th>
                  <th
                    class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider"
                  >
                    H√†nh ƒë·ªông
                  </th>
                </tr>
              </thead>
              <tbody class="bg-white divide-y divide-gray-200">
                <!-- Domain 1 -->
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div class="flex-shrink-0 h-10 w-10">
                        <img
                          class="h-10 w-10 rounded-full"
                          src="images/com.png"
                          alt=".com"
                        />
                      </div>
                      <div class="ml-4">
                        <div class="text-sm font-medium text-gray-900">
                          example.com
                        </div>
                        <div class="text-sm text-gray-500">T√™n mi·ªÅn .com</div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">ns1.example.com</div>
                    <div class="text-sm text-gray-500">ns2.example.com</div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"
                    >
                      Ho·∫°t ƒë·ªông
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    01/01/2024
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium"
                  >
                    <button
                      onclick="editDNS(1, 'example.com', 'ns1.example.com', 'ns2.example.com')"
                      class="text-indigo-600 hover:text-indigo-900 mr-3"
                    >
                      S·ª≠a DNS
                    </button>
                    <button
                      onclick="viewDetails(1)"
                      class="text-blue-600 hover:text-blue-900"
                    >
                      Chi ti·∫øt
                    </button>
                  </td>
                </tr>

                <!-- Domain 2 -->
                <tr class="hover:bg-gray-50">
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="flex items-center">
                      <div class="flex-shrink-0 h-10 w-10">
                        <img
                          class="h-10 w-10 rounded-full"
                          src="images/net.png"
                          alt=".net"
                        />
                      </div>
                      <div class="ml-4">
                        <div class="text-sm font-medium text-gray-900">
                          test.net
                        </div>
                        <div class="text-sm text-gray-500">T√™n mi·ªÅn .net</div>
                      </div>
                    </div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <div class="text-sm text-gray-900">ns1.test.net</div>
                    <div class="text-sm text-gray-500">ns2.test.net</div>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap">
                    <span
                      class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800"
                    >
                      Ho·∫°t ƒë·ªông
                    </span>
                  </td>
                  <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                    02/01/2024
                  </td>
                  <td
                    class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium"
                  >
                    <button
                      onclick="editDNS(2, 'test.net', 'ns1.test.net', 'ns2.test.net')"
                      class="text-indigo-600 hover:text-indigo-900 mr-3"
                    >
                      S·ª≠a DNS
                    </button>
                    <button
                      onclick="viewDetails(2)"
                      class="text-blue-600 hover:text-blue-900"
                    >
                      Chi ti·∫øt
                    </button>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng -->
        <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
          <div class="flex">
            <div class="flex-shrink-0">
              <svg
                class="h-5 w-5 text-blue-400"
                fill="currentColor"
                viewBox="0 0 20 20"
              >
                <path
                  fill-rule="evenodd"
                  d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z"
                  clip-rule="evenodd"
                ></path>
              </svg>
            </div>
            <div class="ml-3">
              <h3 class="text-sm font-medium text-blue-800">
                H∆∞·ªõng d·∫´n qu·∫£n l√Ω domain
              </h3>
              <div class="mt-2 text-sm text-blue-700">
                <ul class="list-disc list-inside space-y-1">
                  <li>
                    <strong>S·ª≠a DNS:</strong> Thay ƒë·ªïi nameserver ƒë·ªÉ tr·ªè domain
                    ƒë·∫øn hosting c·ªßa b·∫°n
                  </li>
                  <li>
                    <strong>Chi ti·∫øt:</strong> Xem th√¥ng tin chi ti·∫øt v·ªÅ domain
                    v√† l·ªãch s·ª≠ thay ƒë·ªïi
                  </li>
                  <li>
                    <strong>DNS c√≥ hi·ªáu l·ª±c:</strong> Thay ƒë·ªïi DNS th∆∞·ªùng c√≥
                    hi·ªáu l·ª±c trong 24-48 gi·ªù
                  </li>
                  <li>
                    <strong>H·ªó tr·ª£:</strong> Li√™n h·ªá support n·∫øu c·∫ßn h·ªó tr·ª£ k·ªπ
                    thu·∫≠t
                  </li>
                </ul>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Modal ch·ªânh s·ª≠a DNS -->
    <div
      id="editDNSModal"
      class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden"
    >
      <div
        class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white"
      >
        <div class="mt-3">
          <h3 class="text-lg font-medium text-gray-900 mb-4">Ch·ªânh s·ª≠a DNS</h3>
          <form id="editDNSForm" method="POST" action="/Ajaxs/UpdateDns.php">
            <input type="hidden" id="edit_domain_id" name="domain_id" />
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Domain</label
              >
              <input
                type="text"
                id="edit_domain_name"
                readonly
                class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100"
              />
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Nameserver 1</label
              >
              <input
                type="text"
                id="edit_ns1"
                name="ns1"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div class="mb-4">
              <label class="block text-sm font-medium text-gray-700 mb-2"
                >Nameserver 2</label
              >
              <input
                type="text"
                id="edit_ns2"
                name="ns2"
                required
                class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
              />
            </div>
            <div class="flex justify-end space-x-2">
              <button
                type="button"
                onclick="closeEditModal()"
                class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600"
              >
                H·ªßy
              </button>
              <button
                type="submit"
                id="updateDNSBtn"
                class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"
              >
                C·∫≠p nh·∫≠t
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <script>
      function editDNS(id, domain, ns1, ns2) {
        document.getElementById("edit_domain_id").value = id;
        document.getElementById("edit_domain_name").value = domain;
        document.getElementById("edit_ns1").value = ns1;
        document.getElementById("edit_ns2").value = ns2;
        document.getElementById("editDNSModal").classList.remove("hidden");
      }

      function closeEditModal() {
        document.getElementById("editDNSModal").classList.add("hidden");
      }

      function viewDetails(id) {
        window.location.href = "domain-detail.php?id=" + id;
      }

      // X·ª≠ l√Ω form c·∫≠p nh·∫≠t DNS
      document
        .getElementById("editDNSForm")
        .addEventListener("submit", function (e) {
          e.preventDefault();

          const updateBtn = document.getElementById("updateDNSBtn");
          const formData = new FormData(this);

          // Disable button v√† hi·ªÉn th·ªã loading
          updateBtn.disabled = true;
          updateBtn.innerHTML = "ƒêang c·∫≠p nh·∫≠t...";

          // G·ª≠i AJAX request
          fetch("/Ajaxs/UpdateDns.php", {
            method: "POST",
            body: formData,
          })
            .then((response) => response.text())
            .then((data) => {
              // Hi·ªÉn th·ªã k·∫øt qu·∫£
              document.body.insertAdjacentHTML("beforeend", data);

              // Reset button
              updateBtn.disabled = false;
              updateBtn.innerHTML = "C·∫≠p nh·∫≠t";

              // ƒê√≥ng modal v√† reload trang sau 2 gi√¢y n·∫øu th√†nh c√¥ng
              if (data.includes("success")) {
                setTimeout(() => {
                  closeEditModal();
                  window.location.reload();
                }, 2000);
              }
            })
            .catch((error) => {
              console.error("Error:", error);
              alert("C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t DNS");

              // Reset button
              updateBtn.disabled = false;
              updateBtn.innerHTML = "C·∫≠p nh·∫≠t";
            });
        });
    </script>
  </body>
</html>
```

## üíª **11. CODE X·ª¨ L√ù:**

### **File: Pages/managers.php**

```php
<?php
session_start();
include_once('../Config/Header.php');

// Ki·ªÉm tra ƒëƒÉng nh·∫≠p
if (!isset($_SESSION['users'])) {
    echo '<script>alert("Vui l√≤ng ƒëƒÉng nh·∫≠p!"); window.location.href="/Pages/login.php";</script>';
    exit;
}

// L·∫•y th√¥ng tin user
$username = $_SESSION['users'];
include_once(__DIR__.'/../Repositories/UserRepository.php');
$userRepo = new UserRepository($connect);
$user = $userRepo->findByUsername($username);

if (!$user) {
    echo '<script>alert("Kh√¥ng t√¨m th·∫•y th√¥ng tin ng∆∞·ªùi d√πng!"); window.location.href="/Pages/login.php";</script>';
    exit;
}

$uid = $user['id'];

// L·∫•y danh s√°ch domain c·ªßa user
include_once(__DIR__.'/../Repositories/HistoryRepository.php');
$historyRepo = new HistoryRepository($connect);
$userDomains = $historyRepo->listByUserId($uid);

// Th·ªëng k√™
$totalDomains = count($userDomains);
$activeDomains = count(array_filter($userDomains, fn($d) => $d['status'] == 1));
?>

<div class="min-h-screen bg-gray-50">
    <!-- Header -->
    <div class="bg-white shadow">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center py-6">
                <h1 class="text-3xl font-bold text-gray-900">Qu·∫£n L√Ω Domain</h1>
                <div class="text-sm text-gray-500">Qu·∫£n l√Ω domain c·ªßa b·∫°n</div>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Th√¥ng tin t√†i kho·∫£n -->
        <div class="bg-white shadow rounded-lg mb-6">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Th√¥ng tin t√†i kho·∫£n</h3>
            </div>
            <div class="p-6">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="text-center">
                        <div class="w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-blue-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M10 9a3 3 0 100-6 3 3 0 000 6zm-7 9a7 7 0 1114 0H3z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900">T√†i kho·∫£n</h4>
                        <p class="text-sm text-gray-500"><?= htmlspecialchars($user['taikhoan']) ?></p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-green-600" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4zM18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z"></path>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900">S·ªë d∆∞</h4>
                        <p class="text-sm text-gray-500"><?= number_format($user['sodu']) ?>ƒë</p>
                    </div>
                    <div class="text-center">
                        <div class="w-16 h-16 bg-purple-100 rounded-full flex items-center justify-center mx-auto mb-3">
                            <svg class="w-8 h-8 text-purple-600" fill="currentColor" viewBox="0 0 20 20">
                                <path fill-rule="evenodd" d="M3 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1zm0 4a1 1 0 011-1h12a1 1 0 110 2H4a1 1 0 01-1-1z" clip-rule="evenodd"></path>
                            </svg>
                        </div>
                        <h4 class="text-sm font-medium text-gray-900">T·ªïng domain</h4>
                        <p class="text-sm text-gray-500"><?= $totalDomains ?> domain</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Danh s√°ch domain -->
        <div class="bg-white shadow rounded-lg">
            <div class="px-6 py-4 border-b border-gray-200">
                <h3 class="text-lg font-medium text-gray-900">Danh s√°ch domain c·ªßa b·∫°n</h3>
            </div>
            <div class="overflow-x-auto">
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Domain</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nameserver</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Tr·∫°ng th√°i</th>
                            <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ng√†y mua</th>
                            <th class="px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider">H√†nh ƒë·ªông</th>
                        </tr>
                    </thead>
                    <tbody class="bg-white divide-y divide-gray-200">
                        <?php if (empty($userDomains)): ?>
                        <tr>
                            <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-500">
                                B·∫°n ch∆∞a c√≥ domain n√†o. <a href="/" class="text-blue-600 hover:underline">Mua domain ngay</a>
                            </td>
                        </tr>
                        <?php else: ?>
                            <?php foreach ($userDomains as $domain): ?>
                            <tr class="hover:bg-gray-50">
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="flex items-center">
                                        <div class="flex-shrink-0 h-10 w-10">
                                            <?php
                                            $domainType = '.' . explode('.', $domain['domain'])[1];
                                            $imagePath = "images/" . str_replace('.', '', $domainType) . ".png";
                                            ?>
                                            <img class="h-10 w-10 rounded-full" src="<?= $imagePath ?>" alt="<?= $domainType ?>">
                                        </div>
                                        <div class="ml-4">
                                            <div class="text-sm font-medium text-gray-900"><?= htmlspecialchars($domain['domain']) ?></div>
                                            <div class="text-sm text-gray-500">T√™n mi·ªÅn <?= htmlspecialchars($domainType) ?></div>
                                        </div>
                                    </div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <div class="text-sm text-gray-900"><?= htmlspecialchars($domain['ns1']) ?></div>
                                    <div class="text-sm text-gray-500"><?= htmlspecialchars($domain['ns2']) ?></div>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap">
                                    <?php
                                    $statusClass = $domain['status'] == 1 ? 'bg-green-100 text-green-800' : 'bg-yellow-100 text-yellow-800';
                                    $statusText = $domain['status'] == 1 ? 'Ho·∫°t ƒë·ªông' : 'Ch·ªù x·ª≠ l√Ω';
                                    ?>
                                    <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full <?= $statusClass ?>">
                                        <?= $statusText ?>
                                    </span>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                                    <?= date('d/m/Y', strtotime($domain['time'])) ?>
                                </td>
                                <td class="px-6 py-4 whitespace-nowrap text-center text-sm font-medium">
                                    <button onclick="editDNS(<?= $domain['id'] ?>, '<?= htmlspecialchars($domain['domain']) ?>', '<?= htmlspecialchars($domain['ns1']) ?>', '<?= htmlspecialchars($domain['ns2']) ?>')"
                                            class="text-indigo-600 hover:text-indigo-900 mr-3">
                                        S·ª≠a DNS
                                    </button>
                                    <button onclick="viewDetails(<?= $domain['id'] ?>)"
                                            class="text-blue-600 hover:text-blue-900">
                                        Chi ti·∫øt
                                    </button>
                                </td>
                            </tr>
                            <?php endforeach; ?>
                        <?php endif; ?>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- H∆∞·ªõng d·∫´n s·ª≠ d·ª•ng -->
        <div class="mt-8 bg-blue-50 border border-blue-200 rounded-lg p-6">
            <div class="flex">
                <div class="flex-shrink-0">
                    <svg class="h-5 w-5 text-blue-400" fill="currentColor" viewBox="0 0 20 20">
                        <path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path>
                    </svg>
                </div>
                <div class="ml-3">
                    <h3 class="text-sm font-medium text-blue-800">
                        H∆∞·ªõng d·∫´n qu·∫£n l√Ω domain
                    </h3>
                    <div class="mt-2 text-sm text-blue-700">
                        <ul class="list-disc list-inside space-y-1">
                            <li><strong>S·ª≠a DNS:</strong> Thay ƒë·ªïi nameserver ƒë·ªÉ tr·ªè domain ƒë·∫øn hosting c·ªßa b·∫°n</li>
                            <li><strong>Chi ti·∫øt:</strong> Xem th√¥ng tin chi ti·∫øt v·ªÅ domain v√† l·ªãch s·ª≠ thay ƒë·ªïi</li>
                            <li><strong>DNS c√≥ hi·ªáu l·ª±c:</strong> Thay ƒë·ªïi DNS th∆∞·ªùng c√≥ hi·ªáu l·ª±c trong 24-48 gi·ªù</li>
                            <li><strong>H·ªó tr·ª£:</strong> Li√™n h·ªá support n·∫øu c·∫ßn h·ªó tr·ª£ k·ªπ thu·∫≠t</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Modal ch·ªânh s·ª≠a DNS -->
<div id="editDNSModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full hidden">
    <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
        <div class="mt-3">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Ch·ªânh s·ª≠a DNS</h3>
            <form id="editDNSForm" method="POST" action="/Ajaxs/UpdateDns.php">
                <input type="hidden" id="edit_domain_id" name="domain_id">
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Domain</label>
                    <input type="text" id="edit_domain_name" readonly
                           class="w-full px-3 py-2 border border-gray-300 rounded-md bg-gray-100">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nameserver 1</label>
                    <input type="text" id="edit_ns1" name="ns1" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="mb-4">
                    <label class="block text-sm font-medium text-gray-700 mb-2">Nameserver 2</label>
                    <input type="text" id="edit_ns2" name="ns2" required
                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
                <div class="flex justify-end space-x-2">
                    <button type="button" onclick="closeEditModal()"
                            class="px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-600">
                        H·ªßy
                    </button>
                    <button type="submit" id="updateDNSBtn"
                            class="px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">
                        C·∫≠p nh·∫≠t
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
function editDNS(id, domain, ns1, ns2) {
    document.getElementById('edit_domain_id').value = id;
    document.getElementById('edit_domain_name').value = domain;
    document.getElementById('edit_ns1').value = ns1;
    document.getElementById('edit_ns2').value = ns2;
    document.getElementById('editDNSModal').classList.remove('hidden');
}

function closeEditModal() {
    document.getElementById('editDNSModal').classList.add('hidden');
}

function viewDetails(id) {
    window.location.href = 'domain-detail.php?id=' + id;
}

// X·ª≠ l√Ω form c·∫≠p nh·∫≠t DNS
document.getElementById('editDNSForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const updateBtn = document.getElementById('updateDNSBtn');
    const formData = new FormData(this);

    // Disable button v√† hi·ªÉn th·ªã loading
    updateBtn.disabled = true;
    updateBtn.innerHTML = 'ƒêang c·∫≠p nh·∫≠t...';

    // G·ª≠i AJAX request
    fetch('/Ajaxs/UpdateDns.php', {
        method: 'POST',
        body: formData
    })
    .then(response => response.text())
    .then(data => {
        // Hi·ªÉn th·ªã k·∫øt qu·∫£
        document.body.insertAdjacentHTML('beforeend', data);

        // Reset button
        updateBtn.disabled = false;
        updateBtn.innerHTML = 'C·∫≠p nh·∫≠t';

        // ƒê√≥ng modal v√† reload trang sau 2 gi√¢y n·∫øu th√†nh c√¥ng
        if (data.includes('success')) {
            setTimeout(() => {
                closeEditModal();
                window.location.reload();
            }, 2000);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t DNS');

        // Reset button
        updateBtn.disabled = false;
        updateBtn.innerHTML = 'C·∫≠p nh·∫≠t';
    });
});
</script>

<?php
include_once('../Config/Footer.php');
?>
```

### **Repository: HistoryRepository->listByUserId()**

```php
public function listByUserId(int $uid): array
{
    try {
        $stmt = $this->mysqli->prepare("
            SELECT h.*, u.taikhoan, u.sodu
            FROM History h
            LEFT JOIN Users u ON h.uid = u.id
            WHERE h.uid = ? AND h.status = 1
            ORDER BY h.time DESC
        ");
        $stmt->bind_param('i', $uid);
        $stmt->execute();
        $result = $stmt->get_result();
        $rows = $result->fetch_all(MYSQLI_ASSOC);
        $stmt->close();

        return $rows;

    } catch (Exception $e) {
        error_log("HistoryRepository->listByUserId() Error: " . $e->getMessage());
        return [];
    }
}

public function findByDomainAndUser(string $domain, int $uid): ?array
{
    $stmt = $this->mysqli->prepare("SELECT * FROM History WHERE domain = ? AND uid = ? AND status = 1 LIMIT 1");
    $stmt->bind_param('si', $domain, $uid);
    $stmt->execute();
    $result = $stmt->get_result();
    $row = $result->fetch_assoc();
    $stmt->close();

    return $row ?: null;
}
```

## üéØ **12. T√ìM T·∫ÆT K·ª∏ THU·∫¨T:**

### **‚úÖ C√¥ng ngh·ªá s·ª≠ d·ª•ng:**

- **Backend:** PHP OOP v·ªõi Repository Pattern
- **Database:** MySQL v·ªõi prepared statements
- **Frontend:** HTML + Tailwind CSS + JavaScript
- **Session:** PHP session management
- **AJAX:** Fetch API cho c·∫≠p nh·∫≠t DNS

### **‚úÖ Ki·∫øn tr√∫c:**

- **Repository Pattern** - T√°ch bi·ªát logic database
- **MVC Pattern** - Model-View-Controller
- **AJAX Pattern** - C·∫≠p nh·∫≠t DNS kh√¥ng reload trang
- **Responsive Design** - Giao di·ªán ƒë·∫πp tr√™n m·ªçi thi·∫øt b·ªã

### **‚úÖ T√≠nh nƒÉng:**

- **Qu·∫£n l√Ω domain** - Xem danh s√°ch domain ƒë√£ mua
- **C·∫≠p nh·∫≠t DNS** - Thay ƒë·ªïi nameserver cho domain
- **Th√¥ng tin t√†i kho·∫£n** - Hi·ªÉn th·ªã s·ªë d∆∞ v√† th·ªëng k√™
- **Modal system** - Ch·ªânh s·ª≠a DNS inline
- **User-friendly** - Giao di·ªán th√¢n thi·ªán, d·ªÖ s·ª≠ d·ª•ng

### **‚úÖ B·∫£o m·∫≠t:**

- **Session Authentication** - Ki·ªÉm tra ƒëƒÉng nh·∫≠p
- **Ownership Validation** - Ch·ªâ hi·ªÉn th·ªã domain c·ªßa user
- **Prepared Statements** - Ch·ªëng SQL injection
- **Input Validation** - Ki·ªÉm tra d·ªØ li·ªáu ƒë·∫ßu v√†o
- **XSS Protection** - Escape output v·ªõi htmlspecialchars

## üé¨ **13. DEMO CH·ª®C NƒÇNG:**

### **B∆∞·ªõc 1: Truy c·∫≠p trang qu·∫£n l√Ω domain**

```
URL: http://localhost/Pages/managers.php
```

### **B∆∞·ªõc 2: Xem th√¥ng tin t√†i kho·∫£n v√† danh s√°ch domain**

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  üåê Qu·∫£n L√Ω Domain                                        ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìä Th√¥ng tin t√†i kho·∫£n:                                  ‚îÇ
‚îÇ  T√†i kho·∫£n: user1    S·ªë d∆∞: 400,000ƒë    T·ªïng domain: 2    ‚îÇ
‚îú‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î§
‚îÇ  üìã Danh s√°ch domain:                                     ‚îÇ
‚îÇ  Domain      ‚îÇ Nameserver        ‚îÇ Tr·∫°ng th√°i ‚îÇ H√†nh ƒë·ªông ‚îÇ
‚îÇ  example.com ‚îÇ ns1.example.com   ‚îÇ Ho·∫°t ƒë·ªông  ‚îÇ [S·ª≠a DNS][Chi ti·∫øt] ‚îÇ
‚îÇ              ‚îÇ ns2.example.com   ‚îÇ            ‚îÇ           ‚îÇ
‚îÇ  test.net    ‚îÇ ns1.test.net      ‚îÇ Ho·∫°t ƒë·ªông  ‚îÇ [S·ª≠a DNS][Chi ti·∫øt] ‚îÇ
‚îÇ              ‚îÇ ns2.test.net      ‚îÇ            ‚îÇ           ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### **B∆∞·ªõc 3: Ch·ªânh s·ª≠a DNS**

- Click **"S·ª≠a DNS"** ‚Üí Hi·ªÉn th·ªã modal
- Thay ƒë·ªïi NS1, NS2 ‚Üí Click **"C·∫≠p nh·∫≠t"**
- AJAX request g·ª≠i ƒëi ‚Üí Hi·ªÉn th·ªã th√¥ng b√°o k·∫øt qu·∫£

### **B∆∞·ªõc 4: K·∫øt qu·∫£**

- **Th√†nh c√¥ng:** "C·∫≠p nh·∫≠t DNS th√†nh c√¥ng! DNS s·∫Ω c√≥ hi·ªáu l·ª±c trong 24-48 gi·ªù."
- **Th·∫•t b·∫°i:** "C√≥ l·ªói x·∫£y ra khi c·∫≠p nh·∫≠t DNS"

### **B∆∞·ªõc 5: C·∫≠p nh·∫≠t giao di·ªán**

- Trang t·ª± ƒë·ªông reload sau 2 gi√¢y
- Hi·ªÉn th·ªã th√¥ng tin DNS m·ªõi

## üéâ **K·∫æT LU·∫¨N:**

**Ch·ª©c nƒÉng qu·∫£n l√Ω domain ƒë√£ ƒë∆∞·ª£c thi·∫øt k·∫ø ho√†n ch·ªânh v·ªõi giao di·ªán ƒë·∫πp, t√≠nh nƒÉng ƒë·∫ßy ƒë·ªß v√† b·∫£o m·∫≠t cao!**

**ƒê·∫∑c ƒëi·ªÉm n·ªïi b·∫≠t:**

- ‚úÖ **Qu·∫£n l√Ω domain chuy√™n nghi·ªáp** - Xem v√† qu·∫£n l√Ω domain d·ªÖ d√†ng
- ‚úÖ **C·∫≠p nh·∫≠t DNS tr·ª±c quan** - Modal ch·ªânh s·ª≠a th√¢n thi·ªán
- ‚úÖ **Th√¥ng tin t√†i kho·∫£n** - Dashboard v·ªõi th·ªëng k√™
- ‚úÖ **B·∫£o m·∫≠t cao** - Ch·ªâ hi·ªÉn th·ªã domain c·ªßa user
- ‚úÖ **Responsive design** - T∆∞∆°ng th√≠ch m·ªçi thi·∫øt b·ªã
- ‚úÖ **AJAX update** - C·∫≠p nh·∫≠t DNS kh√¥ng reload trang
- ‚úÖ **User-friendly** - Giao di·ªán th√¢n thi·ªán, d·ªÖ s·ª≠ d·ª•ng
- ‚úÖ **H∆∞·ªõng d·∫´n chi ti·∫øt** - Gi√∫p user hi·ªÉu c√°ch s·ª≠ d·ª•ng
